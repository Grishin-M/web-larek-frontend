# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных, используемые в приложении

#### Карточка товара

```
export interface ICard {
    _id: string;
    description: string;
    image: string;
    title: string;
    category: string;
    price: number | null;
}
```

#### Список карточек товара на странице

```
export interface ICardList {
    cards: ICard[];
    preview: string | null;
}
```

#### Карточка товара в корзине

```
export type TBasket = Pick<ICard,  'title' | 'price'>;
```

#### Форма выбора способа опллаты и ввод адреса доставки

```
export interface IFormOrder {
    address: string;
    payment: string;
}
```

#### Форма ввод контактных данных пользователя

```
export interface IFormUser {
    email: string;
    phone: string;
}
```

#### Проверка валидации форм

```
export interface IFormOrderValidate {
    checkValidation(data: Record<keyof IFormOrder, string>): boolean;
}

export interface IFormUserValidate {
    checkValidation(data: Record<keyof IFormUser, string>): boolean;
}
```

#### Информация о заказе

```
export interface IOrder {
    items: string[];
    total: number;
}
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:

- слой представления, отвечает за отображение данных на странице
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных

---

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:

- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:

- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие.

#### Класс Component

Абстрактный класс `Component` предназначен для управления разметкой и используется для создания компонентов пользовательского интерфейса.

Методы:

- `render` - рендер разметки
- `setText` - изменение текста в разметке
- `setImage` - изменение картинки в разметке
- `setClass` - изменение стилей в разметке

----

## Слой данных

### Слой Modal

#### Класс DataManager

Класс обеспечивающий работу с данными в приложении.

Свойства:

- catalog: ICard[] - каталог,
- basket: TBasket[] - корзина,
- formErrors: Record<keyof IFormOrder | keyof IFormUser, string> - ошибки ввода формы,
- order: IOrder - информация о заказе.

Методы:

- setCatalog - весь список товаров в каталоге, получаемый с сервера,
- setPreview - предпросмотр товара в модальном окне,
- checkBasket - проверяет наличие товара в корзине,
- addItemToBasket - добавляет товар в корзину,
- clearBasket - очищает корзину,
- removeItemFromBasket - удаляет товар из корзины,
- checkValidation - проверяет валидность форм.

### Слой View

#### Класс Page

Класс использоваться для управления основными элементами интерфейса страницы: каталог товаров, счетчик количества добавленных в корзину товаров, модальное окно.

Свойства:

- \_catalog: HTMLElement - каталога товаров,
- \_counter: HTMLElement - счетчик количества добавленных в корзину товаров,
- \_basket: HTMLElement - корзина.

Методы:

- setCounter - устанавливает значение счетчика,
- setCatalog - обновляет каталог,
- locked - блокирует прокрутку страницы.

#### Класс Modal

Класс реализует модальное окно. Наследует от `Component`.

Свойства :

- \_сloseButton - кнопка для закрытия модального окна
- \_content - контент отображаемый внутри модального окна

Методы:

- set content - заполнение контента модального окна,
- open - открытие модального окна,
- close - закрытие модального окна,
- render - отображение модального окна.

#### Класс Basket

Класс может использоваться для управления функциональностью корзины, включая добавление и удаление товаров из корзины, обновление количества товаров и расчет общей стоимости.

Свойства:

- \_itemsList: HTMLElement - список добавленных в корзину товаров,
- \_totalPrice: HTMLElement - общая стоимость корзины,
- \_button: HTMLElement - кнопка "Оформить".

Методы:

- set ItemsList - обновляет список добавленных в корзину товаров,
- set TotalPrice - обновляет общую стоимость корзины.

#### Класс Form

Класс может использоваться для управления формой, включая валидацию данных, обработку отправки формы и отображение ошибок.

Свойства:

- \_submit: HTMLElement - кнопка подтверждения формы,
- \_error: HTMLElement - сообщение об ошибке.

Методы:

- set Submit - включает и выключает кнопку подтверждения формы взависимости от валидации,
- set Error - отображает ошибку валидации,
- render - отрисовывает форму.

#### Класс FormPayment

Класс может использоваться для управления формы способа оплаты и адреса доставки. Наследуется от класса `Form`.

Свойства:

- \_online: HTMLElement - кнопка оплаты онлайн,
- \_cash: HTMLElement - кнопка оплаты при получении.

Методы:

- set payment - переключение кнопок способов оплаты,
- set address - устанавливает адрес доставки.

#### Класс FormContact

Класс аналогичный `FormPayment`, но для формы с номером телефона и почты пользователя. Также наследуется от класса `Form`.

Методы:

- set phone - устанавливает номер телефона,
- set email - устанавливает электронную почту.

#### Класс PaymentSuccess

Класс представляет успешное сообщение для операции оплаты.

Свойства:

- \_totalPrice: HTMLElement - общая стоимость корзины.

Методы:

- set TotalPrice - обновляет общую стоимость корзины.

### Слой Presenter

События:

- `product:change` - изменение массива товаров,
- `basket:open` - открытие модального окна корзины,
- `basket:change` - изменение товаров в корзине,
- `basket:close` - закрытие модального окна корзины,
- `preview:change` - изменение модального окна превью товара,
- `modal:open` - открытие модального окна,
- `modal:close` - закрытие модального окна,
- `card:add` - добавление карточки в корзину,
- `card:delete` - удаление карточки из корзины,
- `order:submit` - сохранение данных о способе оплаты и адресе доставки,
- `contacts:submit` - событие отправка товара на оплату,
- `order:complete` - при открытии окна успешной оплаты,
- `order:validation` - валидации формы с вводом адреса и способа оплаты,
- `contacts::validation` - валидации формы с контактными данными.

---